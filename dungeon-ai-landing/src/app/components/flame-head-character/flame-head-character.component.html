<!-- Dialog Box - Positioned to the right of character (fixed to screen) -->
<div class="dialog-box"
     *ngIf="showDialog()"
     [style.left.px]="screenX() + 140"
     [style.top.px]="screenY() + 20">
  <div class="dialog-content">
    <div class="dialog-header">
      <span class="dialog-indicator"></span>
      <span class="dialog-title">// SISTEMA IA</span>
    </div>
    <div class="dialog-text">
      <span class="typing-effect">{{ displayedText() }}</span>
      <span class="cursor" *ngIf="isTyping()">_</span>
    </div>
    <div class="dialog-prompt" *ngIf="!isTyping()">
      <span class="blink">[SPACE / ENTER]</span>
    </div>
  </div>
  <div class="dialog-arrow-left"></div>
</div>

<!-- Character SVG - Fixed to center of screen (camera moves world, not character) -->
<svg
  [class]="characterClasses()"
  [style.left.px]="screenX()"
  [style.top.px]="screenY()"
  [style.transform]="characterTransform()"
  width="120"
  height="140"
  viewBox="0 0 120 140">
  <defs>
    <!-- Gradientes verdes Matrix -->
    <linearGradient id="robotBody" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#2a7a2a"/>
      <stop offset="100%" stop-color="#1a5a1a"/>
    </linearGradient>
    <radialGradient id="sensorGlow" cx="50%" cy="50%" r="50%">
      <stop offset="0%" stop-color="#6afa6a" stop-opacity="1"/>
      <stop offset="100%" stop-color="#2a8a2a" stop-opacity="0.3"/>
    </radialGradient>
    <filter id="glow"><feGaussianBlur stdDeviation="2"/></filter>
    <filter id="softGlow"><feGaussianBlur stdDeviation="3"/></filter>
  </defs>

  <g class="body-main">
    <!-- Antena/Sensor en la cabeza -->
    <g class="antenna">
      <!-- Base de la antena -->
      <rect x="58" y="8" width="4" height="8" fill="#1a4a1a"/>
      <!-- Sensor LED pulsante -->
      <circle class="sensor-led" cx="60" cy="5" r="4" fill="url(#sensorGlow)" filter="url(#glow)">
        <animate attributeName="opacity" values="0.6;1;0.6" dur="1.5s" repeatCount="indefinite"/>
      </circle>
      <!-- Glow del sensor -->
      <circle cx="60" cy="5" r="8" fill="#4afa4a" opacity="0.2" filter="url(#softGlow)">
        <animate attributeName="r" values="8;12;8" dur="1.5s" repeatCount="indefinite"/>
        <animate attributeName="opacity" values="0.2;0.4;0.2" dur="1.5s" repeatCount="indefinite"/>
      </circle>
    </g>

    <!-- Visor/Cara pixelada -->
    <rect x="48" y="16" width="24" height="22" fill="#1a4a1a" rx="2" stroke="#2a6a2a" stroke-width="1"/>
    <rect x="50" y="19" width="20" height="16" fill="#0a2a0a"/>
    <g fill="#3a8a3a">
      <rect x="52" y="21" width="2" height="2"/><rect x="56" y="21" width="2" height="2"/>
      <rect x="60" y="21" width="2" height="2"/><rect x="64" y="21" width="2" height="2"/>
      <rect x="54" y="25" width="2" height="2"/><rect x="58" y="25" width="2" height="2"/>
      <rect x="62" y="25" width="2" height="2"/><rect x="66" y="25" width="2" height="2"/>
      <rect x="52" y="29" width="2" height="2"/><rect x="56" y="29" width="2" height="2"/>
      <rect x="60" y="29" width="2" height="2"/><rect x="64" y="29" width="2" height="2"/>
    </g>
    <!-- Pixeles brillantes del visor (ojos) -->
    <rect class="eye-blink" x="54" y="25" width="4" height="2" fill="#6afa6a"/>
    <rect class="eye-blink" x="62" y="25" width="4" height="2" fill="#6afa6a"/>

    <!-- Cuello -->
    <rect x="55" y="38" width="10" height="5" fill="#2a6a2a"/>

    <!-- Torso -->
    <rect x="50" y="43" width="20" height="24" fill="#2a7a2a"/>
    <rect x="52" y="45" width="16" height="3" fill="#3a8a3a"/>
    <rect x="52" y="61" width="16" height="3" fill="#1a5a1a"/>

    <!-- Cintura -->
    <rect x="52" y="67" width="16" height="5" fill="#1a4a1a"/>
  </g>

  <!-- ==================== VISTA LATERAL ==================== -->
  <g class="view-side">
    <!-- Brazo izquierdo -->
    <g class="arm-left">
      <rect x="52" y="45" width="8" height="14" fill="#2a7a2a"/>
      <rect x="50" y="47" width="3" height="10" fill="#3a8a3a"/>
      <rect x="48" y="59" width="8" height="8" fill="#3a8a3a"/>
    </g>

    <!-- Brazo derecho -->
    <g class="arm-right">
      <rect x="60" y="45" width="8" height="14" fill="#2a7a2a"/>
      <rect x="67" y="47" width="3" height="10" fill="#3a8a3a"/>
      <rect x="64" y="59" width="8" height="8" fill="#3a8a3a"/>
    </g>

    <!-- Pierna izquierda -->
    <g class="leg-left">
      <rect x="54" y="72" width="10" height="22" fill="#2a7a2a"/>
      <rect x="52" y="74" width="3" height="18" fill="#3a8a3a"/>
      <rect x="52" y="92" width="10" height="4" fill="#1a4a1a"/>
      <rect x="52" y="96" width="10" height="16" fill="#2a7a2a"/>
      <rect x="52" y="112" width="22" height="5" fill="#1a5a1a"/>
      <rect x="54" y="115" width="24" height="4" fill="#0a3a0a"/>
    </g>

    <!-- Pierna derecha -->
    <g class="leg-right">
      <rect x="56" y="72" width="10" height="22" fill="#2a7a2a"/>
      <rect x="65" y="74" width="3" height="18" fill="#3a8a3a"/>
      <rect x="56" y="92" width="10" height="4" fill="#1a4a1a"/>
      <rect x="56" y="96" width="10" height="16" fill="#2a7a2a"/>
      <rect x="56" y="112" width="22" height="5" fill="#1a5a1a"/>
      <rect x="58" y="115" width="24" height="4" fill="#0a3a0a"/>
    </g>
  </g>

  <!-- ==================== VISTA FRONTAL ==================== -->
  <g class="view-front">
    <!-- FRAME 1 -->
    <g class="frame1">
      <!-- Brazos -->
      <rect x="38" y="45" width="12" height="12" fill="#2a7a2a"/>
      <rect x="36" y="47" width="3" height="8" fill="#3a8a3a"/>
      <rect x="34" y="57" width="10" height="14" fill="#2a7a2a"/>
      <rect x="32" y="71" width="8" height="7" fill="#3a8a3a"/>

      <rect x="70" y="47" width="12" height="10" fill="#1a5a1a"/>
      <rect x="74" y="57" width="10" height="12" fill="#1a5a1a"/>
      <rect x="78" y="69" width="8" height="5" fill="#2a6a2a"/>

      <!-- Piernas -->
      <rect x="50" y="72" width="12" height="22" fill="#2a7a2a"/>
      <rect x="48" y="74" width="3" height="18" fill="#3a8a3a"/>
      <rect x="48" y="92" width="12" height="4" fill="#1a4a1a"/>
      <rect x="46" y="96" width="12" height="16" fill="#2a7a2a"/>
      <rect x="40" y="112" width="18" height="5" fill="#1a5a1a"/>
      <rect x="38" y="115" width="20" height="4" fill="#0a3a0a"/>

      <rect x="60" y="72" width="12" height="18" fill="#1a5a1a"/>
      <rect x="70" y="74" width="3" height="14" fill="#0a3a0a"/>
      <rect x="62" y="88" width="10" height="4" fill="#0a3a0a"/>
      <rect x="66" y="92" width="10" height="14" fill="#1a5a1a"/>
      <rect x="68" y="106" width="14" height="4" fill="#0a3a0a"/>
      <rect x="70" y="108" width="14" height="4" fill="#082808"/>
    </g>

    <!-- FRAME 2 -->
    <g class="frame2">
      <!-- Brazos invertidos -->
      <rect x="70" y="45" width="12" height="12" fill="#2a7a2a"/>
      <rect x="81" y="47" width="3" height="8" fill="#3a8a3a"/>
      <rect x="76" y="57" width="10" height="14" fill="#2a7a2a"/>
      <rect x="80" y="71" width="8" height="7" fill="#3a8a3a"/>

      <rect x="38" y="47" width="12" height="10" fill="#1a5a1a"/>
      <rect x="36" y="57" width="10" height="12" fill="#1a5a1a"/>
      <rect x="34" y="69" width="8" height="5" fill="#2a6a2a"/>

      <!-- Piernas invertidas -->
      <rect x="60" y="72" width="12" height="22" fill="#2a7a2a"/>
      <rect x="70" y="74" width="3" height="18" fill="#3a8a3a"/>
      <rect x="60" y="92" width="12" height="4" fill="#1a4a1a"/>
      <rect x="62" y="96" width="12" height="16" fill="#2a7a2a"/>
      <rect x="62" y="112" width="18" height="5" fill="#1a5a1a"/>
      <rect x="62" y="115" width="20" height="4" fill="#0a3a0a"/>

      <rect x="50" y="72" width="12" height="18" fill="#1a5a1a"/>
      <rect x="48" y="74" width="3" height="14" fill="#0a3a0a"/>
      <rect x="48" y="88" width="10" height="4" fill="#0a3a0a"/>
      <rect x="44" y="92" width="10" height="14" fill="#1a5a1a"/>
      <rect x="38" y="106" width="14" height="4" fill="#0a3a0a"/>
      <rect x="36" y="108" width="14" height="4" fill="#082808"/>
    </g>
  </g>
</svg>
