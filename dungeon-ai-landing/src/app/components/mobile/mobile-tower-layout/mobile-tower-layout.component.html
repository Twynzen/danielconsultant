<!-- Mobile Tower Layout v8.2 - Elevator Design -->
<div class="mobile-tower-wrapper">

  <!-- Fixed Header -->
  <header class="tower-header">
    <div class="header-content">
      <h1 class="title">DESARROLLADOR IA</h1>
    </div>
    <div class="header-glow"></div>
  </header>

  <!-- Main Tower Area with Elevator -->
  <main class="tower-main">
    <!-- Elevator Shaft with markers -->
    <div class="elevator-shaft">
      <!-- Track rails -->
      <div class="shaft-rail left"></div>
      <div class="shaft-rail right"></div>

      <!-- Floor markers (dots) -->
      @for (floor of floors(); track floor.id; let i = $index) {
        <div
          class="floor-marker"
          [class.active]="isRobotOnFloor(i)"
          [style.--floor-index]="i"
        ></div>
      }

      <!-- Elevator cabin with robot -->
      <div
        class="elevator-cabin"
        [class.moving]="isRobotMoving()"
        [style.--floor-index]="elevatorFloorIndex()"
      >
        <div class="cabin-glow"></div>
        <div class="cabin-box">
          <!-- Mini robot inside -->
          <div class="mini-robot">
            <div class="robot-head">
              <div class="robot-eye left"></div>
              <div class="robot-eye right"></div>
            </div>
            <div class="robot-body"></div>
          </div>
        </div>
        <!-- Cabin floor line -->
        <div class="cabin-floor"></div>
      </div>
    </div>

    <!-- Scrollable Tower Floors -->
    <div class="tower-container" #towerContainer>
      <div class="tower-shaft">
        <!-- Tower floors (simplified) -->
        @for (floor of floors(); track floor.id; let i = $index) {
          <div
            class="floor-card"
            [class.active]="isRobotOnFloor(i)"
            [class.highlighted]="highlightedFloorId() === floor.id"
            [class.dimmed]="!isRobotOnFloor(i)"
            [style.--floor-color]="floor.color"
            (click)="onFloorTapped(floor, i)"
          >
            <!-- Icon -->
            <div class="floor-icon" [innerHTML]="getFloorIcon(floor)"></div>

            <!-- Info -->
            <div class="floor-info">
              <h3 class="floor-label">{{ floor.label }}</h3>
              @if (floor.description) {
                <p class="floor-desc">{{ floor.description }}</p>
              }
            </div>

            <!-- Arrow / External indicator -->
            <div class="floor-action">
              @if (isExternalFloor(floor)) {
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/>
                  <polyline points="15 3 21 3 21 9"/>
                  <line x1="10" y1="14" x2="21" y2="3"/>
                </svg>
              } @else {
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="9 18 15 12 9 6"/>
                </svg>
              }
            </div>

            <!-- Highlight glow (after elevator arrives) -->
            @if (highlightedFloorId() === floor.id) {
              <div class="highlight-glow"></div>
            }
          </div>
        }
      </div>
    </div>
  </main>

  <!-- Bottom Chat Button (simplified) -->
  <footer class="chat-footer">
    <button
      class="chat-button"
      (click)="toggleChat()"
      [class.active]="isChatOpen()"
    >
      <div class="chat-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2v10z"/>
        </svg>
      </div>
      <span class="chat-text">CHAT CON SENDELL</span>
      @if (!isChatOpen()) {
        <div class="chat-pulse"></div>
      }
    </button>
  </footer>

  <!-- Chat Panel (slides up) -->
  @if (isChatOpen()) {
    <div class="chat-panel" [class.minimized]="isChatMinimized()">
      <app-mobile-sendell
        [isMinimized]="isChatMinimized()"
        (minimizeChat)="minimizeChat()"
        (closeChat)="closeChat()"
        (actionRequested)="onChatActionRequested($event)"
      />
    </div>
  }

  <!-- Service Info Modal -->
  @if (isModalOpen()) {
    <app-modal-service
      [serviceId]="selectedFloorId()"
      [isOpen]="isModalOpen()"
      [serviceColor]="selectedFloorColor()"
      (closeModal)="closeModal()"
    />
  }

  <!-- Ambient particles (reduced) -->
  <div class="ambient-particles">
    @for (i of [1,2,3,4]; track i) {
      <div class="particle" [style.--delay]="i * 1 + 's'"></div>
    }
  </div>
</div>
