<!-- Mobile Tower Layout v8.2 - Elevator Design -->
<div class="mobile-tower-wrapper">

  <!-- Fixed Header -->
  <header class="tower-header">
    <div class="header-content">
      <h1 class="title">CONSULTOR IA</h1>
      <button class="desktop-link" (click)="goToDesktop()" aria-label="Ver versión desktop">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <rect x="2" y="3" width="20" height="14" rx="2"/>
          <line x1="8" y1="21" x2="16" y2="21"/>
          <line x1="12" y1="17" x2="12" y2="21"/>
        </svg>
      </button>
    </div>
    <div class="header-glow"></div>
  </header>

  <!-- Main Tower Area with Elevator -->
  <main class="tower-main">
    <!-- Elevator Shaft (left side) -->
    <div class="elevator-shaft">
      <div class="shaft-track">
        <!-- Elevator car (Sendell indicator) -->
        <div
          class="elevator-car"
          [class.moving]="isRobotMoving()"
          [style.top.%]="getElevatorPosition()"
        >
          <div class="car-glow"></div>
          <div class="car-body">
            <span class="car-icon">◆</span>
          </div>
        </div>
        <!-- Track markers -->
        @for (floor of floors(); track floor.id; let i = $index) {
          <div
            class="track-marker"
            [class.active]="isRobotOnFloor(i)"
            [style.top.%]="(i / (floors().length - 1)) * 100"
          ></div>
        }
      </div>
    </div>

    <!-- Scrollable Tower Floors -->
    <div class="tower-container" #towerContainer>
      <div class="tower-shaft">
        <!-- Tower floors (simplified) -->
        @for (floor of floors(); track floor.id; let i = $index) {
          <div
            class="floor-card"
            [class.active]="activeFloorId() === floor.id"
            [class.has-elevator]="isRobotOnFloor(i)"
            [style.--floor-color]="floor.color"
            (click)="onFloorTapped(floor, i)"
          >
            <!-- Icon -->
            <div class="floor-icon" [innerHTML]="getFloorIcon(floor)"></div>

            <!-- Info -->
            <div class="floor-info">
              <h3 class="floor-label">{{ floor.label }}</h3>
              @if (floor.description) {
                <p class="floor-desc">{{ floor.description }}</p>
              }
            </div>

            <!-- Arrow / External indicator -->
            <div class="floor-action">
              @if (isExternalFloor(floor)) {
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/>
                  <polyline points="15 3 21 3 21 9"/>
                  <line x1="10" y1="14" x2="21" y2="3"/>
                </svg>
              } @else {
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="9 18 15 12 9 6"/>
                </svg>
              }
            </div>

            <!-- Active glow -->
            @if (activeFloorId() === floor.id || isRobotOnFloor(i)) {
              <div class="active-glow"></div>
            }
          </div>
        }
      </div>
    </div>
  </main>

  <!-- Bottom Chat Button (simplified) -->
  <footer class="chat-footer">
    <button
      class="chat-button"
      (click)="toggleChat()"
      [class.active]="isChatOpen()"
    >
      <div class="chat-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2v10z"/>
        </svg>
      </div>
      <span class="chat-text">CHAT CON SENDELL</span>
      @if (!isChatOpen()) {
        <div class="chat-pulse"></div>
      }
    </button>
  </footer>

  <!-- Chat Panel (slides up) -->
  @if (isChatOpen()) {
    <div class="chat-panel" [class.minimized]="isChatMinimized()">
      <app-mobile-sendell
        [isMinimized]="isChatMinimized()"
        (minimizeChat)="minimizeChat()"
        (closeChat)="closeChat()"
        (actionRequested)="onChatActionRequested($event)"
      />
    </div>
  }

  <!-- Service Info Modal -->
  @if (isModalOpen()) {
    <app-modal-service
      [serviceId]="selectedFloorId()"
      [isOpen]="isModalOpen()"
      [serviceColor]="selectedFloorColor()"
      (closeModal)="closeModal()"
    />
  }

  <!-- Ambient particles (reduced) -->
  <div class="ambient-particles">
    @for (i of [1,2,3,4]; track i) {
      <div class="particle" [style.--delay]="i * 1 + 's'"></div>
    }
  </div>
</div>
